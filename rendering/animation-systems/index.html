<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-rendering/animation-systems" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Animation Systems | Ragnarok Research Lab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ragnarokresearchlab.github.io/rendering/animation-systems/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Animation Systems | Ragnarok Research Lab"><meta data-rh="true" name="description" content="This document describes the different animation systems used in the Ragnarok Online client"><meta data-rh="true" property="og:description" content="This document describes the different animation systems used in the Ragnarok Online client"><link data-rh="true" rel="icon" href="/img/favicon-with-transparency.png"><link data-rh="true" rel="canonical" href="https://ragnarokresearchlab.github.io/rendering/animation-systems/"><link data-rh="true" rel="alternate" href="https://ragnarokresearchlab.github.io/rendering/animation-systems/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ragnarokresearchlab.github.io/rendering/animation-systems/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f93bf3a0.css">
<link rel="preload" href="/assets/js/runtime~main.fa76f376.js" as="script">
<link rel="preload" href="/assets/js/main.2ad5f1eb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-with-more-space-around.png" alt="Ragnarok Research Lab Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-with-more-space-around.png" alt="Ragnarok Research Lab Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Ragnarok Research Lab</b></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/file-formats/">File Formats</a><a class="navbar__item navbar__link" href="/rendering/">Rendering</a><a class="navbar__item navbar__link" href="/game-mechanics/">Game Mechanics</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/contributing/">Contribute</a><a href="https://discord.gg/7RFdMNrySy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/RagnarokResearchLab" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/about/">About</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contributing/">Contributing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/file-formats/">File Formats</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/rendering/">Rendering</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rendering/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rendering/coordinate-systems/">Coordinate Systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rendering/ground-mesh/">Ground Mesh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rendering/camera-controls/">Camera Controls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rendering/animation-systems/">Animation Systems</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/game-mechanics/">Game Mechanics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/arcturus/">Arcturus</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/community-projects/">Community Projects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/glossary/">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Rendering</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Animation Systems</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Animation Systems</h1></header><p>This document describes the different animation systems used in the Ragnarok Online client</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sprite-animations">Sprite Animations<a href="#sprite-animations" class="hash-link" aria-label="Direct link to Sprite Animations" title="Direct link to Sprite Animations">​</a></h2><p>In this context, &quot;sprite animations&quot; refers to the animations generated from data stored in <a href="/file-formats/act/">ACT</a> and <a href="/file-formats/spr/">SPR</a> files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="act-frame-times">ACT Frame Times<a href="#act-frame-times" class="hash-link" aria-label="Direct link to ACT Frame Times" title="Direct link to ACT Frame Times">​</a></h3><p>One curiosity is the animation delay stored in the <a href="/file-formats/act/">ACT</a> files. While other files may provide animation times in the unit of &quot;frames&quot; (assuming a stable frame rate of 60 FPS), or milliseconds, ACT delays don&#x27;t inherently make sense in a vacuum.</p><p>Traditionally, tools and third-party implementations have computed the ACT frame duration as follows:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">FrameDisplayTimeInMilliseconds</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">AnimationClip</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">FrameTimeInIntervals</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Before diving into the accuracy of this estimate (<em>spoiler alert - it&#x27;s slightly off</em>), some questions immediately spring to mind:</p><ul><li>Why is the frame time given in &quot;intervals&quot; (as ACT editor calls them) in the first place?</li><li>Where does the 25 ms time value that has so far been used by the community actually come from?</li><li>Is it at all correct, and is there a way to precisely measure sprite animation times to verify/disprove this?</li></ul><p>The following sections attempt to answer these questions, as far as is realistically possible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="animation-state-updates">Animation State Updates<a href="#animation-state-updates" class="hash-link" aria-label="Direct link to Animation State Updates" title="Direct link to Animation State Updates">​</a></h3><p>In order to answer the first question, a bit of guesswork is needed. There&#x27;s of course no way of telling for sure why this peculiar unit of measurement was chosen by the game&#x27;s developers. But knowing a bit about the different animation systems in the client, a likely explanation is that sprite animations use a different mechanism altogether (e.g., clock-based state machines).</p><p>If one assumes the existence of one or several timers that update the animation state machines, operating at a fixed clock speed, it wouldn&#x27;t be as far-fetched to describe frame display times in terms of full cycles on this clock. In fact, there is some evidence that other systems (e.g., particles) do indeed involve such self-clocking mechanisms to compute their own time deltas.</p><p>This might seem like a peculiar design choice compared to a global delta time (the &quot;standard&quot; approach). However, it&#x27;s clear that there are several different animation systems working to animate objects such as the Granny3D models, water surfaces, particle systems, and RSM(2) models<sup id="fnref-*"><a href="#fn-*" class="footnote-ref">*</a></sup>. In light of this, adding one more for sprites to the mix doesn&#x27;t seem particularly strange.</p><p><sup id="fnref-*"><a href="#fn-*" class="footnote-ref">*</a></sup> This is obvious since they all use different units of measurement; Also, GR2 models were added much later in development.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="predicting-animation-times">Predicting Animation Times<a href="#predicting-animation-times" class="hash-link" aria-label="Direct link to Predicting Animation Times" title="Direct link to Predicting Animation Times">​</a></h3><p>Allowing for the above assumptions, it&#x27;s possible to explain why intervals where chosen as the unit of measurement for ACT animations. However, the exact time value is yet to be determined. While the origin of the 25 ms interval time appears to be lost to history, the number is probably an estimate based on recording frame times. But - as far as I can tell - <em>it&#x27;s subtly wrong</em>.</p><p>In order to accurately compute the most likely time value, and confirm or disprove the hypothesis that it&#x27;s 25 ms, one might:</p><ul><li>Mathematically model the expected animation duration for different clock speeds, in both milliseconds and frames</li><li>Take into account the variance introduced by discrete rendering steps (it&#x27;s not possible to render partial frames, after all)</li><li>Record animation cycles at different speeds and sample the observed frame durations at various clock interval times</li><li>Compare the observed frame counts per animation clip to the predicted results, accounting for measurement error</li></ul><p>This allows progressively eliminating impossible times until the range of possible interval times narrows in on a value.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="observed-frame-durations">Observed Frame Durations<a href="#observed-frame-durations" class="hash-link" aria-label="Direct link to Observed Frame Durations" title="Direct link to Observed Frame Durations">​</a></h3><p>Let&#x27;s get the conclusion out of the way first: Based on my experiments, the real interval time is actually <strong>24 ms</strong>.</p><p>Showing why 25 ms can&#x27;t be right involves a little bit of math to predict possible frame times over time. The idea being:</p><ul><li>If the real time was exactly 25 ms (which is the hypothesis to test), then observations must always lie within ~1 frame</li><li>Even with a rendering delay greater than one frame, it would be equal for all ACT interval counts (assuming a stable 60 FPS)</li><li>However, should the time be wrong, this error will accumulate, becoming more pronounced at higher interval counts</li></ul><p>If the prediction is off but very close, this might be invisible in a 100 ms animation sequence (same rendered frame). But when the same sequence is stretched out to last several seconds, the error should be amplified greatly and eventually become observable. When a tiny difference (such as 1 ms per interval) is added up repeatedly, it soon amounts to multiple frames.</p><p>And indeed, this is precisely what happens. The orange boxes highlight the discrepancy between predicted and observed times:</p><p><img loading="lazy" alt="act-frame-timings-discrepancy.png" src="/assets/images/act-frame-timings-discrepancy-2ececaea797f64db6ebebbeb85d992c1.png" width="1649" height="840" class="img_ev3q"></p><p>While analyzing recordings and comparing observed frame times to the predictions, a few things quickly become clear:</p><ul><li>The 25ms duration appears accurate at first glance, e.g., when recording a Poring&#x27;s IDLE animation at normal speed</li><li>However, this is almost certainly a happy coincidence and due to falling within the same rendered frame (~16.667 ms)</li><li>Increasing the interval count to even just 40 leads to recordings &quot;missing&quot; frames that should exist, if 25 ms was correct</li><li>At this count, the range can be narrowed down to <code>(23.75, 24.165)</code> purely based on the number of observed frames</li><li>It can be seen that the predicted frame times diverge ever further from the observed ones as higher values are used</li></ul><p>In fact, the range of possible clock interval times narrows in on exactly 24 ms as the overall display duration increases:</p><p><img loading="lazy" alt="act-frame-timings-observed.png" src="/assets/images/act-frame-timings-observed-0302b5be2bc556faab11f25ff9928377.png" width="1614" height="161" class="img_ev3q"></p><p>At the above interval count of 128, the difference between both models is significant; this can no longer be explained by mere variance - or even measurement errors. What&#x27;s more, the predicted frame time matches the observed time almost exactly if <em>and only if</em> the real period is actually 24 ms (and not 25). Therefore, the animation system must be working with 24 ms intervals.</p><p><em>NOTE: If you want to reproduce these results, you can find all of the relevant files <a href="https://valkyrie-realm.net/research/act-frame-times/" target="_blank" rel="noopener noreferrer">here</a>, alongside some rudimentary usage instructions.</em></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/RagnarokResearchLab/ragnarokresearchlab.github.io/edit/main/docs/rendering/animation-systems.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rendering/camera-controls/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Camera Controls</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/game-mechanics/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sprite-animations" class="table-of-contents__link toc-highlight">Sprite Animations</a><ul><li><a href="#act-frame-times" class="table-of-contents__link toc-highlight">ACT Frame Times</a></li><li><a href="#animation-state-updates" class="table-of-contents__link toc-highlight">Animation State Updates</a></li><li><a href="#predicting-animation-times" class="table-of-contents__link toc-highlight">Predicting Animation Times</a></li><li><a href="#observed-frame-durations" class="table-of-contents__link toc-highlight">Observed Frame Durations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/file-formats/">File Formats</a></li><li class="footer__item"><a class="footer__link-item" href="/rendering/">Rendering</a></li><li class="footer__item"><a class="footer__link-item" href="/game-mechanics/">Game Mechanics</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/contributing/">Contributing</a></li><li class="footer__item"><a href="https://discord.gg/7RFdMNrySy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/RagnarokResearchLab" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community-projects/">Related Projects</a></li></ul></div><div class="col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tools/#ebm-export-with-zlib">EBM Export (with zlib)</a></li><li class="footer__item"><a class="footer__link-item" href="/tools/#euc-kr-path-conversion">EUC-KR Path Conversion</a></li><li class="footer__item"><a class="footer__link-item" href="/tools/#raglite-developer-toolkit">RagLite Developer Toolkit</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Ragnarok Research Lab (authors and contributors).<br>All trademarks referenced herein are the properties of their respective owners.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fa76f376.js"></script>
<script src="/assets/js/main.2ad5f1eb.js"></script>
</body>
</html>