"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[542],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=d(a),u=r,h=c["".concat(s,".").concat(u)]||c[u]||p[u]||i;return a?n.createElement(h,o(o({ref:t},m),{},{components:a})):n.createElement(h,o({ref:t},m))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<i;d++)o[d]=a[d];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},990:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return p}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],l={sidebar_position:30,slug:"/rendering/camera-controls",title:"Camera Controls"},s=void 0,d={unversionedId:"rendering/camera-controls",id:"rendering/camera-controls",title:"Camera Controls",description:"This document describes the camera controller used by the Ragnarok Online client.",source:"@site/docs/rendering/camera-controls.md",sourceDirName:"rendering",slug:"/rendering/camera-controls",permalink:"/rendering/camera-controls",editUrl:"https://github.com/RagnarokResearchLab/ragnarokresearchlab.github.io/edit/main/docs/rendering/camera-controls.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30,slug:"/rendering/camera-controls",title:"Camera Controls"},sidebar:"tutorialSidebar",previous:{title:"Ground Mesh",permalink:"/rendering/ground-mesh"},next:{title:"Overview",permalink:"/game-mechanics"}},m={},p=[{value:"Orbital Camera",id:"orbital-camera",level:2},{value:"Perspective Projection",id:"perspective-projection",level:2},{value:"Fixed Viewpoints",id:"fixed-viewpoints",level:2},{value:"Data Tables",id:"data-tables",level:3},{value:"Viewpoint Table Layout",id:"viewpoint-table-layout",level:3},{value:"Orbital Rotations",id:"orbital-rotations",level:2}],c={toc:p};function u(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This document describes the camera controller used by the Ragnarok Online client."),(0,i.kt)("h2",{id:"orbital-camera"},"Orbital Camera"),(0,i.kt)("p",null,"The game uses a flexible but fairly standard camera system, known under many different names, to create a third-person POV:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The distance from the camera target is given as a radius (in world units)"),(0,i.kt)("li",{parentName:"ul"},"Players can adjust the camera on two angles, horizontally and vertically"),(0,i.kt)("li",{parentName:"ul"},"In RO, only half of the horizontal range can be explored (for technical and probably stylistic reasons)")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://doc.babylonjs.com/features/featuresDeepDive/cameras/camera_introduction#arc-rotate-camera"},"Here's")," and example explaining how it works; this is not engine-specific but rather a general method of rendering a 3D scene."),(0,i.kt)("h2",{id:"perspective-projection"},"Perspective Projection"),(0,i.kt)("p",null,"The camera settings control how exactly the scene is projected on the viewport window, giving the game its unique look:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The vertical field of view was claimed to be 15 degrees ","[by curiosity]",", which is a bit of a... curiosity (hah)"),(0,i.kt)("li",{parentName:"ul"},"The near plane is located at a distance of 10 (2 if normalized) world units - the size of one GND surface"),(0,i.kt)("li",{parentName:"ul"},"... and the far plane seems to be at a distance of 1500 (300 if normalized) world units, just outside the fog sphere")),(0,i.kt)("p",null,"It's important to point out the unusually narrow ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Field_of_view"},"field of view")," as it directly impacts how fog effects color the scene."),(0,i.kt)("h2",{id:"fixed-viewpoints"},"Fixed Viewpoints"),(0,i.kt)("p",null,"Certain maps lock in the camera settings, limiting the player's ability to adjust them (without hacking the client, that is)."),(0,i.kt)("h3",{id:"data-tables"},"Data Tables"),(0,i.kt)("p",null,"There are two data files (CSV tables) that control the fixed viewpoint camera on a per-map basis."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"data/indoorRswTable.txt"),": Features a list of maps for which camera adjustments should be disabled"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"data/viewpointtable.txt"),": Compliments the above with fixed viewpoints for a selection of maps")),(0,i.kt)("p",null,"The format of the files is quite simple:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If a map's ",(0,i.kt)("a",{parentName:"li",href:"/file-formats/rsw"},"RSW")," file is listed in the ",(0,i.kt)("inlineCode",{parentName:"li"},"indoorRswTable"),", orbital rotations will be disabled completely for the map"),(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"viewpointtable"),' defines what camera angles to allow for the given map (no entry means "use default values")'),(0,i.kt)("li",{parentName:"ul"},"Entries in the viewpoint table are separated by hashtags (",(0,i.kt)("inlineCode",{parentName:"li"},"#"),") and arbitrary amounts of whitespace characters")),(0,i.kt)("h3",{id:"viewpoint-table-layout"},"Viewpoint Table Layout"),(0,i.kt)("p",null,"Viewpoint presets are defined by the following fields:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"Index"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Field"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"center"},"Interpretation"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"0"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"mapID")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"string")),(0,i.kt)("td",{parentName:"tr",align:"center"},"The name of the map's RSW resource file (with extension)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"1"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"range")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Minimum radial distance from the camera to the player character (in world units)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"2"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"scope")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Maximum radial distance adjustment that is allowed on top of ",(0,i.kt)("inlineCode",{parentName:"td"},"range")," (in world units)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"3"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"range_IN")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Initial radial distance from the camera to the player character (in world units)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"4"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"rotationFrom")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Minimum longitude of the camera's ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/Azimuth"},"azimuth")," angle (in degrees)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"5"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"rotationTo")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Maximum longitude of the camera's ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/Azimuth"},"azimuth")," angle (in degrees)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"6"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"rotation_IN")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Initial longitude of the camera's ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/Azimuth"},"azimuth")," angle (in degrees)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"7"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"altitudeFrom")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Minimum latitude of the camera's ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/Spherical_coordinate_system"},"polar")," angle (in degrees)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"8"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"altitudeTo")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Maximum latitude of the camera's ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/Spherical_coordinate_system"},"polar")," angle (in degrees)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},"9"),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"altitude_IN")),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("inlineCode",{parentName:"td"},"int")),(0,i.kt)("td",{parentName:"tr",align:"center"},"Initial latitude of the camera's ",(0,i.kt)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/Spherical_coordinate_system"},"polar")," angle (in degrees)")))),(0,i.kt)("p",null,"Here's an example entry for the viewpoint table:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-txt"},"ex_map02.rsw#   250#    250#    500#        0#      90#     45#     -40#        -65#        -65#\n")),(0,i.kt)("p",null,"If this map was to be loaded, the camera's range of movement would be limited such that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"It starts zoomed out at the maximum radial distance of 500 (100 if normalized) world units"),(0,i.kt)("li",{parentName:"ul"},"You can't zoom further in than 250 (50 if normalized) world units from the player character"),(0,i.kt)("li",{parentName:"ul"},"You can't zoom further out than the maximum distance (500, or 100 if normalized)"),(0,i.kt)("li",{parentName:"ul"},"You ",(0,i.kt)("em",{parentName:"li"},"can")," zoom in and out freely between the two thresholds by scrolling the mouse wheel"),(0,i.kt)("li",{parentName:"ul"},"The horizontal (azimuth) angle can be adjusted freely from 0 to 90 degrees"),(0,i.kt)("li",{parentName:"ul"},"The vertical (polar) angle can be adjusted from ",(0,i.kt)("em",{parentName:"li"},"positive")," 40 to 65 degrees (remember that ",(0,i.kt)("a",{parentName:"li",href:"/rendering/coordinate-systems#world-coordinates"},"the game world is upside down"),")")),(0,i.kt)("p",null,"Upon loading the map, the client places the camera so that it orbits the player at ",(0,i.kt)("inlineCode",{parentName:"p"},"(45, 65)")," in spherical coordinates."),(0,i.kt)("h2",{id:"orbital-rotations"},"Orbital Rotations"),(0,i.kt)("p",null,'The origin of the spherical coordinates appears to be "looking into the screen" (alongside the positive Z axis). That is to say, rotating the camera by ',(0,i.kt)("inlineCode",{parentName:"p"},"(0, 0)")," in spherical coordinates would place it at ",(0,i.kt)("inlineCode",{parentName:"p"},"(0, 0, -1)")," in world coordinates. Camera rotations work similarly to directional lighting - as far as I can tell - although sunrays originate from ",(0,i.kt)("inlineCode",{parentName:"p"},"(0, 1, 0)")," (in a non-inverted system) ",(0,i.kt)("sup",{parentName:"p",id:"fnref-1"},(0,i.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),"."),(0,i.kt)("p",null,"As for rotating alongside the axes, a few observations can be made:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Increasing the latitude (polar angle) rotates the camera clockwise around the X axis ",(0,i.kt)("strong",{parentName:"li"},"in RO's world coordinates")," (!)"),(0,i.kt)("li",{parentName:"ul"},'Due to the inverted Y axis, these angles are always negative - positive values would move the camera "under the ground"'),(0,i.kt)("li",{parentName:"ul"},"In a normalized coordinate system, north-south rotations must be inverted to move ",(0,i.kt)("em",{parentName:"li"},"counterclockwise"),' ("up" and not "down")'),(0,i.kt)("li",{parentName:"ul"},"Adding to the longitude (azimuth angle) rotates the camera clockwise around the Y axis, which works fine if normalized")),(0,i.kt)("p",null,"For a specific example, you can take a look at how the viewpoint controls the camera in Nameless Island (",(0,i.kt)("inlineCode",{parentName:"p"},"abbey01"),"):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'The azimuth angle can be adjusted from 0 to 70 degrees; it\'s easy to confirm that the camera will only move to the "left"'),(0,i.kt)("li",{parentName:"ul"},"Polar angles range from -50 to -70 (meaning, 50 to 70 if normalized), and indeed the vertical range of motion is quite small")),(0,i.kt)("p",null,'While it\'s not possible to "see" that the world is upside down, negative polar angles in the table imply that it probably is ',(0,i.kt)("sup",{parentName:"p",id:"fnref-2"},(0,i.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),"."),(0,i.kt)("div",{className:"footnotes"},(0,i.kt)("hr",{parentName:"div"}),(0,i.kt)("ol",{parentName:"div"},(0,i.kt)("li",{parentName:"ol",id:"fn-1"},"Derived by applying the same rotations with directional light angles stored in the ",(0,i.kt)("a",{parentName:"li",href:"/file-formats/rsw"},"RSW")," file and visually checking the result",(0,i.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")),(0,i.kt)("li",{parentName:"ol",id:"fn-2"},"Considering that terrain altitudes and water levels are also inverted in the game files, this seems like a safe bet.",(0,i.kt)("a",{parentName:"li",href:"#fnref-2",className:"footnote-backref"},"\u21a9")))))}u.isMDXComponent=!0}}]);