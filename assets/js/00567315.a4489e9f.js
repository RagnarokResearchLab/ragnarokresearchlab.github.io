"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6482],{3209:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"file-formats/GR2","title":"GR2","description":"This document describes the GR2 file format used in the Ragnarok Online client.","source":"@site/docs/file-formats/GR2.md","sourceDirName":"file-formats","slug":"/file-formats/gr2","permalink":"/file-formats/gr2","draft":false,"unlisted":false,"editUrl":"https://github.com/RagnarokResearchLab/ragnarokresearchlab.github.io/edit/main/docs/file-formats/GR2.md","tags":[],"version":"current","frontMatter":{"slug":"/file-formats/gr2","title":"GR2"},"sidebar":"tutorialSidebar","previous":{"title":"GND","permalink":"/file-formats/gnd"},"next":{"title":"GRF","permalink":"/file-formats/grf"}}');var n=s(4848),r=s(8453);const a={slug:"/file-formats/gr2",title:"GR2"},o=void 0,l={},d=[{value:"Contents",id:"contents",level:2},{value:"Layout",id:"layout",level:2},{value:"Oodle Compression",id:"oodle-compression",level:2},{value:"Data Segments",id:"data-segments",level:2},{value:"Data Tracks",id:"data-tracks",level:3},{value:"See also",id:"see-also",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"This document describes the GR2 file format used in the Ragnarok Online client."}),"\n",(0,n.jsx)(t.h2,{id:"contents",children:"Contents"}),"\n",(0,n.jsxs)(t.p,{children:["GR2 files are binary data stores created by the proprietary ",(0,n.jsx)(t.a,{href:"http://www.radgametools.com/granny.html",children:"Granny3D"})," SDK. They contain the following:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"3D mesh geometry and textures for the WoE guardians, emperium, treasure box, and guild flag"}),"\n",(0,n.jsx)(t.li,{children:"Skeletons and pose animations for the above models (in separate files, one per model and pose)"}),"\n",(0,n.jsx)(t.li,{children:"Some leftover (unfinished) data for a potential 3D Novice-class player character"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Although the format is widely used in the games industry, only the specific version used in RO is referenced here."}),"\n",(0,n.jsx)(t.h2,{id:"layout",children:"Layout"}),"\n",(0,n.jsx)(t.p,{children:"The layout is quite complex and has been described elsewhere:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["A great description is found at the ",(0,n.jsx)(t.a,{href:"https://github.com/arves100/opengr2/wiki/File-Format-documentation",children:"OpenGR2 wiki"}),", which contains many details worth reading"]}),"\n",(0,n.jsxs)(t.li,{children:["The ",(0,n.jsx)(t.a,{href:"https://github.com/rdw-archive/RagnarokFileFormats/blob/master/GR2.MD",children:"previous version"})," of this documentation is still available (warning: may contain inaccuracies and errors)"]}),"\n",(0,n.jsx)(t.li,{children:"Alternate implementations exist on GitHub, several of which are listed in the above document"}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["As of 2023, there appears to be no third-party implementation that doesn't rely on the ",(0,n.jsx)(t.code,{children:"granny2.dll"})," in at least some way."]}),"\n",(0,n.jsx)(t.h2,{id:"oodle-compression",children:"Oodle Compression"}),"\n",(0,n.jsx)(t.p,{children:"This is just a quick correction to the original article, which mentions the use of Huffman tables."}),"\n",(0,n.jsxs)(t.p,{children:["According to ",(0,n.jsx)(t.a,{href:"https://fgiesen.wordpress.com/2022/04/04/entropy-decoding-in-oodle-data-huffman-decoding-on-the-jaguar/#comment-23605",children:"this blog comment by Fabian Giesen"})," (of RAD), Oodle-0 is actually\nusing a standard ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/LZ77_and_LZ78#LZ77",children:"Lempel-Ziv-77"})," compressor combined with a (presumably adaptive) ",(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Arithmetic_coding",children:"arithmetic encoder"}),". Indeed it appears that the compressed GR2 segments are fed into the AE decoder and then the LZ decompressor, though the specifics of how the arithmetic coding works aren't exactly clear."]}),"\n",(0,n.jsx)(t.h2,{id:"data-segments",children:"Data Segments"}),"\n",(0,n.jsx)(t.p,{children:"All GR2 files are split into multiple segments, which can be individually compressed. Cursory data analysis yields:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The first segments is always large (and often the largest), presumably containing the bulk of the data tree"}),"\n",(0,n.jsx)(t.li,{children:"Segments two, three, four, and five likely contain the geometry as they're absent from RO skeletons"}),"\n",(0,n.jsx)(t.li,{children:"Segments two and three are always used together; the same goes for four and five (hinting at related data)"}),"\n",(0,n.jsx)(t.li,{children:"Segment two is always larger than three, and segment four is always larger than five - which hints at vertices/indices"}),"\n",(0,n.jsx)(t.li,{children:"A reasonable guess is that those are just vertex positions, indices, normals, etc., split according to statistical properties"}),"\n",(0,n.jsx)(t.li,{children:"The last segment is large and always uncompressed, probably containing the (already-compressed) textures"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"It's been reported that other games may use more segments (unverified claim), but in RO there are always six."}),"\n",(0,n.jsx)(t.h3,{id:"data-tracks",children:"Data Tracks"}),"\n",(0,n.jsxs)(t.p,{children:["Oodle-0 compressed segments consist of multiple data tracks, which are defined by the start and end offset, as well as certain compressor settings. The range (",(0,n.jsx)(t.code,{children:"from"})," and ",(0,n.jsx)(t.code,{children:"to"}),") is defined in the segment header, while compression parameters and inputs for the arithmetic decoder can be found at the start of each compressed segment. More research is needed on these parameters."]}),"\n",(0,n.jsx)(t.h2,{id:"see-also",children:"See also"}),"\n",(0,n.jsx)(t.p,{children:"Here's a few resources that might help with understanding the Oodle decompression:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-wusp/fb98aa28-5cd7-407f-8869-a6cef1ff1ccb",children:"Explanation of the LZ77 compression algorithm"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://go-compression.github.io/",children:"The Hitchhiker's Guide to Compression"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://marknelson.us/posts/2014/10/19/data-compression-with-arithmetic-coding.html",children:"Data Compression With Arithmetic Coding"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Arithmetic_coding",children:"Arithmetic coding (Wikipedia)"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://www.youtube.com/@mathematicalmonk/videos",children:"Arithmetic coding - Video series on YouTube (by mathematicalmonk)"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>o});var i=s(6540);const n={},r=i.createContext(n);function a(e){const t=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);