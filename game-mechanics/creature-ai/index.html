<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-game-mechanics/creature-ai" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Creature AI and Skillsets | Ragnarok Research Lab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ragnarokresearchlab.github.io/game-mechanics/creature-ai/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Creature AI and Skillsets | Ragnarok Research Lab"><meta data-rh="true" name="description" content="This document describes how Ragnarok Online&#x27;s zone servers determine the behavior of AI-enabled actors in the game world."><meta data-rh="true" property="og:description" content="This document describes how Ragnarok Online&#x27;s zone servers determine the behavior of AI-enabled actors in the game world."><link data-rh="true" rel="icon" href="/img/favicon-with-transparency.png"><link data-rh="true" rel="canonical" href="https://ragnarokresearchlab.github.io/game-mechanics/creature-ai/"><link data-rh="true" rel="alternate" href="https://ragnarokresearchlab.github.io/game-mechanics/creature-ai/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ragnarokresearchlab.github.io/game-mechanics/creature-ai/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Creature AI and Skillsets","item":"https://ragnarokresearchlab.github.io/game-mechanics/creature-ai"}]}</script><link rel="stylesheet" href="/assets/css/styles.6f30c7a3.css">
<script src="/assets/js/runtime~main.25137bea.js" defer="defer"></script>
<script src="/assets/js/main.9c4bacf8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-with-more-space-around.png" alt="Ragnarok Research Lab Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-with-more-space-around.png" alt="Ragnarok Research Lab Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ragnarok Research Lab</b></a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/file-formats/">File Formats</a><a class="navbar__item navbar__link" href="/rendering/">Rendering</a><a class="navbar__item navbar__link" href="/game-mechanics/">Game Mechanics</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/contributing/">Contribute</a><a href="https://discord.gg/7RFdMNrySy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/RagnarokResearchLab" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/about/">About</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contributing/">Contributing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/file-formats/">File Formats</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rendering/">Rendering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/game-mechanics/">Game Mechanics</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/game-mechanics/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/game-mechanics/world-state-updates/">World State Updates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/game-mechanics/movement/">Movement and Pathfinding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/game-mechanics/creature-ai/">Creature AI and Skillsets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/game-mechanics/effects/">Skills and Spell Effects</a><button aria-label="Expand sidebar category &#x27;Skills and Spell Effects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/arcturus/">Arcturus</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/community-projects/">Community Projects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/glossary/">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Game Mechanics</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Creature AI and Skillsets</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Creature AI and Skillsets</h1></header><p>This document describes how Ragnarok Online&#x27;s zone servers determine the behavior of AI-enabled actors in the game world.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-of-ai-behavior">Model of AI Behavior<a href="#model-of-ai-behavior" class="hash-link" aria-label="Direct link to Model of AI Behavior" title="Direct link to Model of AI Behavior">​</a></h2>
<p>The behaviors of ingame actors can be sorted into a few basic categories:</p>
<ul>
<li>Movement: Random walks, following parents, and chasing targets</li>
<li>Combat: Reacting to attacks/spellcasts, target selection (including AOI checks)</li>
<li>Looting: Picking up items from the floor, and moving to an item&#x27;s location</li>
</ul>
<p>This kind of logic is represented by a set of state transitions, here called <em>AI preset</em>, and assigned to creatures. It can also be changed on the fly to enable more complex reactions and facilitate somewhat dynamic reactions to gameplay situations.</p>
<p>Then, there&#x27;s two additional categories worth exploring separately:</p>
<ul>
<li>Skills: Abilities that are defined for each creature type, and specific to only it</li>
<li>NPC Events: Unrelated to creatures, they&#x27;re behind regular dialogs and player-NPC interactions</li>
</ul>
<p>The first is implemented via a set of predefined rules making up the skill usage patterns for a given unit class (monster type), which is called the monster&#x27;s <em>skillset</em>. Skills are then used based on the current state and probabilities for each configured event.</p>
<p><em>NPC events</em> are a special case and only apply to regular (non-creature) NPCs, which are technically using the same framework but with fewer, specialized states and no transitions. The state of NPC actors doesn&#x27;t really change, so they&#x27;re always &quot;Idle&quot;.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ai-state-changes">AI State Changes<a href="#ai-state-changes" class="hash-link" aria-label="Direct link to AI State Changes" title="Direct link to AI State Changes">​</a></h2>
<p>A finite state machine (FSM) represents the behavior of each actor. The state of this machine changes based on inputs provided by ingame events, which the zone server feeds into the FSM as part of its <a href="/game-mechanics/world-state-updates/#simulation-steps">World State Update</a> loop. After processing an input, the server emits another event as the FSM&#x27;s output, to be processed in the same update loop - or possibly in the next iteration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-of-ai-states">List of AI States<a href="#list-of-ai-states" class="hash-link" aria-label="Direct link to List of AI States" title="Direct link to List of AI States">​</a></h3>
<p>The list of supported AI states is short, but their interpretation isn&#x27;t always straight-forward:</p>
<table><thead><tr><th style="text-align:center">State ID</th><th style="text-align:center">Interpretation</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td style="text-align:center"><code>ABNORMAL_ST</code></td><td style="text-align:center">Status</td><td style="text-align:center">Impacted by loss of control effects that prevent it from acting normally</td></tr><tr><td style="text-align:center"><code>ANGRY_ST</code></td><td style="text-align:center">Enraged</td><td style="text-align:center">Aggressively attacking or chasing target, using an alternate behavior set (switches after being attacked)</td></tr><tr><td style="text-align:center"><code>BERSERK_ST</code></td><td style="text-align:center">Attacking</td><td style="text-align:center">In range and actively attacking their target</td></tr><tr><td style="text-align:center"><code>DEAD_ST</code></td><td style="text-align:center">Dead</td><td style="text-align:center">Currently removed from the map (inactive until respawn)</td></tr><tr><td style="text-align:center"><code>FOLLOW_SEARCH_ST</code></td><td style="text-align:center">Scanning (Follow)</td><td style="text-align:center">Seeking new targets in the area of interest, while following a parent unit</td></tr><tr><td style="text-align:center"><code>FOLLOW_ST</code></td><td style="text-align:center">Following</td><td style="text-align:center">Moving to a new location, while following a parent unit</td></tr><tr><td style="text-align:center"><code>IDLE_ST</code></td><td style="text-align:center">Idle</td><td style="text-align:center">No action is currently in progress (default)</td></tr><tr><td style="text-align:center"><code>MOVEITEM_ST</code></td><td style="text-align:center">Looting</td><td style="text-align:center">Moving towards an item, with the intent to loot it</td></tr><tr><td style="text-align:center"><code>RMOVE_ST</code></td><td style="text-align:center">Walking</td><td style="text-align:center">Moving (random walk, when not in combat)</td></tr><tr><td style="text-align:center"><code>RUSH_ST</code></td><td style="text-align:center">Pursuing</td><td style="text-align:center">Chasing down a target (player), with the intent to attack it</td></tr><tr><td style="text-align:center"><code>SEARCH_ST</code></td><td style="text-align:center">Scanning</td><td style="text-align:center">Monitoring the area of interest to find new targets</td></tr></tbody></table>
<p><em>Source: <a href="https://cp.kokotewa.com/resources/database" target="_blank" rel="noopener noreferrer">Kokotewa&#x27;s RO database</a> (contains the AI states, presets, and transitions for any given creature)</em></p>
<p>Some more details about the (somewhat confusing) <code>ANGRY_ST</code> state:</p>
<blockquote>
<p>Angry: These mobs are &quot;hyper-active&quot;. Apart from &quot;chase&quot;/&quot;attack&quot;, they have the states &quot;follow&quot;/&quot;angry&quot;. Once hit, they stop using these states and use the normal ones. The new states are used to determine a different skill-set for their &quot;before attacked&quot; and &quot;after attacked&quot; states. Also, when &quot;following&quot;, they automatically switch to whoever character is closest.</p>
</blockquote>
<p><em>Source: <a href="https://github.com/HerculesWS/Hercules/blob/7b77b4e549c091580f43b61a755d6edbda611c60/doc/mob_db_mode_list.md" target="_blank" rel="noopener noreferrer">Hercules documentation</a> (also contains other information about the AI system)</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="input-and-output-events">Input and Output Events<a href="#input-and-output-events" class="hash-link" aria-label="Direct link to Input and Output Events" title="Direct link to Input and Output Events">​</a></h2>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>This section contains unverified information and/or speculation. It may or may not be completely wrong.</p></div></div>
<p>AI state changes are triggered by certain game events, which serve as <em>input</em> to the underlying FSM. Similarly, state transitions emit <em>output</em> events which can then influence the game world. The exact order this happens isn&#x27;t entirely clear, but there&#x27;s some evidence the output events are emitted some time <em>before</em> the resulting state transition is executed:</p>
<blockquote>
<p>The term spawn is misleading as monsters don’t technically die, rather monsters are temporarily removed from the map. This is important because when a monster is returned to the map the monster AI will remain in the previous state, e.g. if a monster is aggressive to a player, and were to respawn near that player, it will remain aggressive towards that player. While this is rarely encountered due to a combination of horizontal/vertical position variance and non-zero regeneration timers it does explain otherwise inexplicable behavior, e.g. an ordinarily passive monster respawning with aggressive behavior.</p>
</blockquote>
<p>Source: <a href="https://blog.kokotewa.com/monster-spawns/" target="_blank" rel="noopener noreferrer">Kokotewa&#x27;s blog</a></p>
<p>For any of that to happen, it would be necessary for state changes to have the ability to override each other... like so:</p>
<ol>
<li>Creature is &quot;killed&quot; (removed from map) and flagged as &quot;dead&quot; (regenerating)</li>
<li>The respawn timer expires, which triggers the regeneration logic</li>
<li>The creature is revived in its original AI state (output event triggers here)</li>
<li><strong>It &quot;spawns&quot; next to a player, still in its original AI state</strong></li>
<li>The player&#x27;s proximity triggers the appropriate input event</li>
<li>The creature immediately attacks the player, switching AI states</li>
<li>The &quot;idle&quot; output state is never reached, because another transition overrode it</li>
</ol>
<p>If there was no player to attack when the creature respawns, it should follow that instead of 5 to 7, the output state will then be set (after the &quot;scanning for targets&quot; step). Since anecdotal evidence for such situations is plentiful, that&#x27;s probably what&#x27;s going on in the background. This is of course mere conjecture, but there&#x27;s no other explanation for the aforementioned phenomenon.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-of-input-events">List of Input Events<a href="#list-of-input-events" class="hash-link" aria-label="Direct link to List of Input Events" title="Direct link to List of Input Events">​</a></h3>
<p>These are the ingame events that can trigger FSM state transitions:</p>
<table><thead><tr><th style="text-align:center">ID</th><th style="text-align:center">Description</th><th style="text-align:center">Scope</th></tr></thead><tbody><tr><td style="text-align:center"><code>ARENASTART_IN</code></td><td style="text-align:center">Some &quot;arena&quot; (PVP) event was started (?)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>ARRIVEDAT_ITEM_IN</code></td><td style="text-align:center">The creature arrived at the location of the item it is currently trying to loot</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>ATTACKED_IN</code></td><td style="text-align:center">The creature was attacked (by a player?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>CHANGE_NORMALST_IN</code></td><td style="text-align:center">All loss of control effects were removed from the creature</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>CHARACTER_ATTACKSIGHT_IN</code></td><td style="text-align:center">A player entered the creature&#x27;s attack range (on their own?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>CHARACTER_INATTACKSIGHT_IN</code></td><td style="text-align:center">The creature reached the targeted unit and is now within attack range</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>CHARACTER_INSIGHT_IN</code></td><td style="text-align:center">A player entered the creature&#x27;s area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>CLICK_IN</code></td><td style="text-align:center">The NPC was clicked (player started interacting with it)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>DEADSTATE_TIMEOUT_IN</code></td><td style="text-align:center">The respawn timer for the creature has elapsed</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>DESTINATION_ARRIVED_IN</code></td><td style="text-align:center">The creature has arrived at the target location of its most recent movement action</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>ENEMY_INATTACKSIGHT_IN</code></td><td style="text-align:center">The targeted player is within the creature&#x27;s attack range</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>ENEMY_OUTATTACKSIGHT_IN</code></td><td style="text-align:center">The targeted player is outside the creature&#x27;s attack range (but within its area of interest)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>ENEMY_OUTSIGHT_IN</code></td><td style="text-align:center">The targeted player has left the creature&#x27;s area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>ENERGY_RECHARGED_IN</code></td><td style="text-align:center">The creature&#x27;s power has replenished (?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>FRIEND_ATTACKED_IN</code></td><td style="text-align:center">An allied creature was attacked in the creature&#x27;s area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>G_CHARACTER_ATTACKSIGHT_IN</code></td><td style="text-align:center">A player entered the WOE guardian&#x27;s attack range (?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>G_CHARACTER_INSIGHT_IN</code></td><td style="text-align:center">A player entered the WOE guardian&#x27;s area of interest (?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>ITEM_INSIGHT_IN</code></td><td style="text-align:center">A lootable item was detected in the creature&#x27;s area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>LOWERLEVEL_INSIGHT_IN</code></td><td style="text-align:center">A viable target (low level player?) has been detected in the creature&#x27;s area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MAGIC_LOCKON_IN</code></td><td style="text-align:center">A spellcast targeting the creature was detected</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MILLI_ATTACKED_IN</code></td><td style="text-align:center">The creature was attacked (by a player?) in melee range</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MOVE_END_POS_IN</code></td><td style="text-align:center">The creature has arrived (after moving to a new location)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MOVE_RANDOM_END_IN</code></td><td style="text-align:center">The random movement delay timer is about to be reset</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MOVE_START_IN</code></td><td style="text-align:center">The creature is about to start moving to a new location</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MYOWNER_ATTACKED_IN</code></td><td style="text-align:center">The unit&#x27;s parent unit was attacked</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MYOWNER_OUTSIGHT_IN</code></td><td style="text-align:center">The unit&#x27;s parent has left the area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>NEAREST_CHARACTER_IN</code></td><td style="text-align:center">The nearest player (or other unit?) has been updated for this creature</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>TARGET_ITEM_DISAPPEAR_IN</code></td><td style="text-align:center">The item that the creature was trying to loot has disappeared from the floor</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>TOUCHED_IN</code></td><td style="text-align:center">A player has moved on or directly adjacent to the NPC</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>TOUCHED2_IN</code></td><td style="text-align:center">A player or a party member has moved on or directly adjacent to the NPC (?)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>TOUCHEDNPC_IN</code></td><td style="text-align:center">Another NPC has moved on or directly adjacent to the NPC (?)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>WAIT_END_IN</code></td><td style="text-align:center">The random movement delay timer has elapsed</td><td style="text-align:center">MOB</td></tr></tbody></table>
<p>Some of them are only used for &quot;friendly&quot; units, like vendors and quest NPCs. This is usually evident from the event description, but the additional &quot;scope&quot; field should help to make it even clearer. Such a distinction does not exist in the game, as all NPC actors can theoretically be assigned arbitrary events and states (though the resulting behavior might be undefined).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-of-output-events">List of Output Events<a href="#list-of-output-events" class="hash-link" aria-label="Direct link to List of Output Events" title="Direct link to List of Output Events">​</a></h3>
<p>These are ingame events emitted by the FSM when a state transition completes:</p>
<table><thead><tr><th style="text-align:center">ID</th><th style="text-align:center">Description</th><th style="text-align:center">Scope</th></tr></thead><tbody><tr><td style="text-align:center"><code>CALL_ARENASTART_OUT</code></td><td style="text-align:center">Starts an &quot;arena&quot; (PVP) event (?)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>CALL_CLICKEVENT_OUT</code></td><td style="text-align:center">Triggers the NPC&#x27;s <code>OnClick</code> handler</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>CALL_TOUCHEVENT_OUT</code></td><td style="text-align:center">Triggers the NPC&#x27;s <code>OnTouch</code> handler (NPC touched by player)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>CALL_TOUCHEVENT2_OUT</code></td><td style="text-align:center">Triggers the NPC&#x27;s <code>OnTouch2</code> handler (NPC touched by player or party member?)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>CALL_TOUCHNPCEVENT_OUT</code></td><td style="text-align:center">Triggers the NPC&#x27;s <code>OnTouchNPC</code> handler (NPC touched by other NPC?)</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>CHANGE_ENEMY_OUT</code></td><td style="text-align:center">Attempts to change targets (start scanning?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>CHANGE_NORMALST_OUT</code></td><td style="text-align:center">Restores the default (&quot;Idle&quot;) state</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>EXPEL_OUT</code></td><td style="text-align:center">Starts pursuing a target, outside of the creature&#x27;s attack range</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MOVE_RANDOM_START_OUT</code></td><td style="text-align:center">Starts a new random walk</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MOVE_START_OUT</code></td><td style="text-align:center">Starts a (random?) walk, for NPCs only?</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>MOVETO_ITEM_OUT</code></td><td style="text-align:center">Starts moving to the location of an item on the floor</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>MOVETO_MYOWNER_OUT</code></td><td style="text-align:center">Starts moving to the parent unit (reduce distance?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>NONE_OUT</code></td><td style="text-align:center">Does nothing (dummy event?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>PICKUP_ITEM_OUT</code></td><td style="text-align:center">Makes the creature loot an item</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>REVENGE_ENEMY_OUT</code></td><td style="text-align:center">Starts using attacks (and/or abilities?) on a hostile unit in attack range?</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>REVENGE_RANDOM_OUT</code></td><td style="text-align:center">Starts using attacks (and/or abilities?) on a random hostile unit in attack range?</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>SEARCH_OUT</code></td><td style="text-align:center">Starts scanning for targets in the area of interest</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>STOP_AND_CLICKEVENT_OUT</code></td><td style="text-align:center">Stops NPC movement, then triggers its <code>OnClick</code> handler?</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>STOP_MOVE_OUT</code></td><td style="text-align:center">Stops the current movement, discarding the path</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>TRADE_START_OUT</code></td><td style="text-align:center">Opens the vendor&#x27;s trading window?</td><td style="text-align:center">NPC</td></tr><tr><td style="text-align:center"><code>TRY_REVIVAL_OUT</code></td><td style="text-align:center">Attempt to regenerate the creature (can this fail?)</td><td style="text-align:center">MOB</td></tr><tr><td style="text-align:center"><code>WAIT_START_OUT</code></td><td style="text-align:center">Starts the random walk delay timer</td><td style="text-align:center">MOB</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ai-presets">AI Presets<a href="#ai-presets" class="hash-link" aria-label="Direct link to AI Presets" title="Direct link to AI Presets">​</a></h2>
<p>All creatures in RO follow a simplistic routine that is derived from predefined configuration settings (the &quot;AI presets&quot;). These categorize monsters roughly by their intended approach to interacting with other actors in the game world, and are then enriched with specific ability usage patterns (the &quot;skillsets&quot;) for each individual creature type to create additional depth.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preset-swaps">Preset Swaps<a href="#preset-swaps" class="hash-link" aria-label="Direct link to Preset Swaps" title="Direct link to Preset Swaps">​</a></h3>
<p>Presets aren&#x27;t fixed, but rather assigned. The implication is that creatures are free to change between archetypes if their custom logic so dictates. While this doesn&#x27;t affect their skill usage, as skillsets are static and tied to the unit&#x27;s class, it can make monsters prioritize targets differently or move in new ways. That&#x27;s what happens when bosses &quot;enrage&quot;, presumably.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-of-ai-presets">List of AI Presets<a href="#list-of-ai-presets" class="hash-link" aria-label="Direct link to List of AI Presets" title="Direct link to List of AI Presets">​</a></h3>
<p>There are <a href="https://github.com/HerculesWS/Hercules/blob/7b77b4e549c091580f43b61a755d6edbda611c60/doc/mob_db_mode_list.md#aegis-mob-types" target="_blank" rel="noopener noreferrer">at least 27 known behavior archetypes</a> that form the basis of the AI system. A complete list is difficult to compile and somewhat out of scope, but <a href="https://cp.kokotewa.com/resources/database" target="_blank" rel="noopener noreferrer">Kokotewa&#x27;s database</a> shows the archetype for each creature if you feel like cross-referencing them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="skill-usage">Skill Usage<a href="#skill-usage" class="hash-link" aria-label="Direct link to Skill Usage" title="Direct link to Skill Usage">​</a></h2>
<p>Skills are used according to a predefined behavior table for each creature type, based on the creature&#x27;s current AI state and random chance, as well as certain conditions. Additionally, emotes and chat output can be triggered via this mechanism.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skillsets">Skillsets<a href="#skillsets" class="hash-link" aria-label="Direct link to Skillsets" title="Direct link to Skillsets">​</a></h3>
<p>The logic for any creature&#x27;s skill usage patterns is defined by the following information:</p>
<ul>
<li>Creature ID: The unique identifier referring to the creature&#x27;s unit class</li>
<li>Input State ID: One of the aforementioned AI state identifiers (e.g., <code>IDLE_ST</code>)</li>
<li>Skill ID: The unique identifier defining the skill to be used</li>
<li>Level: The level of the skill that should be cast</li>
<li>Chance: Probability for the creature to use the skill</li>
<li>Cast Time: Time before the cast is actually completed</li>
<li>Delay: Timeout for this trigger</li>
</ul>
<p>These properties are mandatory and largely self-explanatory in their meaning. However, some optional properties also exist:</p>
<ul>
<li>A flag indicating whether the cast can be interrupted (by damage or use of the Dispel ability)</li>
<li>An AI preset ID to swap to in response to the trigger, if any</li>
<li>A flag indicating whether emotes or chat messages should be sent</li>
<li>If emotes or chat are used: An identifier for the emoticon or chat message (taken from a predefined table)</li>
<li>A keyword for additional conditions that need to be fulfilled (e.g., &quot;the number of minions is lower than X&quot;)</li>
<li>A conditional value that should be evaluated as part of the condition (that&#x27;s the &quot;X&quot; part in this example)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="emotes">Emotes<a href="#emotes" class="hash-link" aria-label="Direct link to Emotes" title="Direct link to Emotes">​</a></h3>
<p>Emotes are triggered at the end of the cast. It&#x27;s unknown whether they still trigger if the cast was interrupted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monster-talk">Monster Talk<a href="#monster-talk" class="hash-link" aria-label="Direct link to Monster Talk" title="Direct link to Monster Talk">​</a></h3>
<p>The RO client contains a &quot;monster talk table&quot; (<code>data/monster_talk_table.xml</code>), which stores the text that would be displayed as part of a creature&#x27;s skillset. It seems that this feature is no longer in use, most likely because it&#x27;s annoying. Although it&#x27;s seen use on some private servers in the past, it&#x27;s unclear whether AI-controlled messages were at some point enabled on official servers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-keywords">Conditional Keywords<a href="#conditional-keywords" class="hash-link" aria-label="Direct link to Conditional Keywords" title="Direct link to Conditional Keywords">​</a></h3>
<p>Here&#x27;s the list of all known special conditional keywords:</p>
<table><thead><tr><th style="text-align:center">Keyword ID</th><th style="text-align:center">Operator</th><th style="text-align:center">Expected Value</th><th style="text-align:center">Interpretation</th><th style="text-align:center">Example Usage</th></tr></thead><tbody><tr><td style="text-align:center"><code>IF_ALCHEMIST</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">Flag to enable alternate skillsets for summoned plants</td><td style="text-align:center">Marine Sphere: Self Destruct</td></tr><tr><td style="text-align:center"><code>IF_COMRADECONDITION</code></td><td style="text-align:center"><code>===</code></td><td style="text-align:center">Effect ID</td><td style="text-align:center">Allied creature is afflicted by status effect</td><td style="text-align:center">Chepet: Status Recovery</td></tr><tr><td style="text-align:center"><code>IF_COMRADEHP</code></td><td style="text-align:center"><code>&lt;=</code></td><td style="text-align:center">Number</td><td style="text-align:center">Allied creature is below health percentage</td><td style="text-align:center">Angeling: Heal</td></tr><tr><td style="text-align:center"><code>IF_ENEMYCOUNT</code></td><td style="text-align:center"><code>&gt;=</code></td><td style="text-align:center">Number</td><td style="text-align:center">Number of enemies in attack range is above threshold</td><td style="text-align:center">Alarm: Splash Attack</td></tr><tr><td style="text-align:center"><code>IF_HIDING</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">Unit is hidden (Hiding skill)</td><td style="text-align:center">Smokie: Heal</td></tr><tr><td style="text-align:center"><code>IF_HP</code></td><td style="text-align:center"><code>&lt;=</code></td><td style="text-align:center">Number</td><td style="text-align:center">Unit&#x27;s health is below threshold</td><td style="text-align:center">Sohee: Suicide</td></tr><tr><td style="text-align:center"><code>IF_MAGICLOCKED</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">Unit&#x27;s cast detection has triggered</td><td style="text-align:center">Amon Ra: Summon Monster</td></tr><tr><td style="text-align:center"><code>IF_MASTERATTACKED</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">Parent unit was recently attacked (?)</td><td style="text-align:center">Summoned Hydra (Alchemist): Revenge</td></tr><tr><td style="text-align:center"><code>IF_MASTERHP</code></td><td style="text-align:center"><code>&lt;=</code></td><td style="text-align:center">Number</td><td style="text-align:center">Parent unit&#x27;s health is below threshold</td><td style="text-align:center">Summoned Geographer (Alchemist): Heal</td></tr><tr><td style="text-align:center"><code>IF_RANGEATTACKED</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">Unit was recently hit by a ranged attack</td><td style="text-align:center">Errende Ebecee (BioLabs Acolyte): Pneuma</td></tr><tr><td style="text-align:center"><code>IF_RUDEATTACK</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">Unit was hit, but cannot retaliate (no path to attacker available?)</td><td style="text-align:center">Every creature: Teleport</td></tr><tr><td style="text-align:center"><code>IF_SKILLUSE</code></td><td style="text-align:center"><code>===</code></td><td style="text-align:center">Skill ID</td><td style="text-align:center">Unit was hit by skill (must be damaging?)</td><td style="text-align:center">Eddga: Fireball (when hit by Fire Wall damage)</td></tr><tr><td style="text-align:center"><code>IF_SLAVENUM</code></td><td style="text-align:center"><code>&lt;=</code></td><td style="text-align:center">Number</td><td style="text-align:center">Number of minions alive is below threshold</td><td style="text-align:center">Garm: Summon Slave</td></tr><tr><td style="text-align:center"><code>IF_TRICKCASTING</code></td><td style="text-align:center">---</td><td style="text-align:center">---</td><td style="text-align:center">No idea (placeholder?)</td><td style="text-align:center">Marine Sphere: Speed Up</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples">​</a></h3>
<p>The following screenshot of <code>ANGELING</code>&#x27;s skillset (taken from <a href="https://cp.kokotewa.com/resources/mon_info?id=ANGELING" target="_blank" rel="noopener noreferrer">Kokotewa&#x27;s RO database</a>) illustrates the format well:</p>
<p><img decoding="async" loading="lazy" alt="Screenshot of the skillset table for ANGELING" src="/assets/images/04-monster-skillset-example-7bfd0138c4c4ae61f4cddb05a290abcc.png" width="746" height="517" class="img_ev3q"></p>
<p>Accordingly, its skill usage pattern for Summon Slave can be summed up in a few sentences:</p>
<blockquote>
<p>Angeling has a 100% chance to summon new followers, when it&#x27;s attacking or idle and the number of existing minions is three or less. This cast takes 2 seconds, is not interruptible, and can only be used once per minute. It will emote <code>/heh</code> afterwards.</p>
</blockquote>
<p>A similar interpretation of any other skill trigger is possible. In combination, they fully define the entire skillset.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/RagnarokResearchLab/ragnarokresearchlab.github.io/edit/main/docs/game-mechanics/04-creature-ai.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/game-mechanics/movement/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Movement and Pathfinding</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/game-mechanics/effects/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Skills and Spell Effects</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model-of-ai-behavior" class="table-of-contents__link toc-highlight">Model of AI Behavior</a></li><li><a href="#ai-state-changes" class="table-of-contents__link toc-highlight">AI State Changes</a><ul><li><a href="#list-of-ai-states" class="table-of-contents__link toc-highlight">List of AI States</a></li></ul></li><li><a href="#input-and-output-events" class="table-of-contents__link toc-highlight">Input and Output Events</a><ul><li><a href="#list-of-input-events" class="table-of-contents__link toc-highlight">List of Input Events</a></li><li><a href="#list-of-output-events" class="table-of-contents__link toc-highlight">List of Output Events</a></li></ul></li><li><a href="#ai-presets" class="table-of-contents__link toc-highlight">AI Presets</a><ul><li><a href="#preset-swaps" class="table-of-contents__link toc-highlight">Preset Swaps</a></li><li><a href="#list-of-ai-presets" class="table-of-contents__link toc-highlight">List of AI Presets</a></li></ul></li><li><a href="#skill-usage" class="table-of-contents__link toc-highlight">Skill Usage</a><ul><li><a href="#skillsets" class="table-of-contents__link toc-highlight">Skillsets</a></li><li><a href="#emotes" class="table-of-contents__link toc-highlight">Emotes</a></li><li><a href="#monster-talk" class="table-of-contents__link toc-highlight">Monster Talk</a></li><li><a href="#conditional-keywords" class="table-of-contents__link toc-highlight">Conditional Keywords</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about/">About</a></li><li class="footer__item"><a class="footer__link-item" href="/file-formats/">File Formats</a></li><li class="footer__item"><a class="footer__link-item" href="/rendering/">Rendering</a></li><li class="footer__item"><a class="footer__link-item" href="/game-mechanics/">Game Mechanics</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/contributing/">Contributing</a></li><li class="footer__item"><a href="https://discord.gg/7RFdMNrySy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/RagnarokResearchLab" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community-projects/">Related Projects</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Tools</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/tools/#ebm-export-with-zlib">EBM Export (with zlib)</a></li><li class="footer__item"><a class="footer__link-item" href="/tools/#euc-kr-path-conversion">EUC-KR Path Conversion</a></li><li class="footer__item"><a class="footer__link-item" href="/tools/#raglite-developer-toolkit">RagLite Developer Toolkit</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Ragnarok Research Lab (authors and contributors).<br>All trademarks referenced herein are the properties of their respective owners.</div></div></div></footer></div>
</body>
</html>